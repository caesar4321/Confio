{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
  <h1>Withdraw collected cUSD</h1>
  <p><strong>Phase:</strong> {{ phase }}</p>
  <ul>
    <li><strong>App cUSD balance:</strong> {{ cusd_balance|floatformat:6 }} cUSD</li>
  </ul>

  {% if form %}
    <form method="post">{% csrf_token %}
      <input type="hidden" name="select_across" value="0" />
      <input type="hidden" name="index" value="0" />
      {% for obj in queryset %}
        <input type="hidden" name="_selected_action" value="{{ obj.pk }}" />
      {% endfor %}
      {{ form.as_p }}
      <input type="hidden" name="action" value="{{ action }}" />
      <input type="hidden" name="apply" value="1" />
      <input type="submit" class="default" value="Withdraw all cUSD" />
    </form>
  {% else %}
    <p><em>Form unavailable due to configuration/selection issue.</em></p>
  {% endif %}
  {% if result_message %}
    <p><strong>{{ result_message }}</strong></p>
  {% endif %}
  {% if error_message %}
    <p style="color:#b94a48"><strong>Error:</strong> {{ error_message }}</p>
  {% endif %}
  {% if tx_id %}
    <div style="margin-top:1em">
      <p><strong>Transaction submitted.</strong></p>
      <ul>
        <li><strong>Tx ID:</strong> {{ tx_id }}</li>
        {% if withdrawn_cusd %}<li><strong>Amount:</strong> {{ withdrawn_cusd|floatformat:6 }} cUSD</li>{% endif %}
        {% if receiver_addr %}<li><strong>Receiver:</strong> {{ receiver_addr }}</li>{% endif %}
      </ul>
    </div>
  {% endif %}
  <p><a href="{{ request.META.HTTP_REFERER }}">Back</a></p>
{% endblock %}
